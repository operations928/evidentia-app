<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TOC - Evidence Based Security</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <script src="/socket.io/socket.io.js"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    
    <style>
        /* --- THEME & LAYOUT --- */
        :root { --bg: #0f172a; --panel: #1e293b; --text: #e2e8f0; --accent: #3b82f6; --red: #ef4444; --green: #10b981; --orange: #f59e0b; }
        * { box-sizing: border-box; }
        body { margin: 0; font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); display: flex; height: 100vh; overflow: hidden; }
        
        .sidebar { width: 240px; background: var(--panel); border-right: 1px solid #334155; display: flex; flex-direction: column; z-index: 50; transition: transform 0.3s; }
        .main-content { flex: 1; display: flex; flex-direction: column; position: relative; width: 100%; }
        
        @media (max-width: 768px) {
            .sidebar { position: fixed; height: 100%; transform: translateX(-100%); }
            .sidebar.open { transform: translateX(0); }
            .top-deck { height: 35% !important; }
            .radio-silo { display: none; } 
            .bottom-deck { flex-direction: column; }
            .menu-toggle { display: block !important; }
        }

        .menu-toggle { display: none; position: absolute; top: 10px; left: 10px; z-index: 1000; background: var(--panel); border: 1px solid #334155; padding: 8px; border-radius: 4px; color: white; cursor: pointer; }
        .top-deck { height: 40%; display: flex; border-bottom: 2px solid #334155; }
        .bottom-deck { flex: 1; display: flex; overflow: hidden; }
        .radio-silo { width: 300px; background: #0b1120; border-right: 1px solid #334155; display: flex; flex-direction: column; }
        .workspace { flex: 1; background: var(--bg); display: flex; flex-direction: column; overflow: hidden; }

        /* --- UI COMPONENTS --- */
        .nav-cat { font-size: 0.7rem; text-transform: uppercase; color: #64748b; margin: 15px 0 5px 15px; font-weight: bold; }
        .nav-btn { background: transparent; border: none; color: #94a3b8; padding: 12px 15px; text-align: left; cursor: pointer; width: 100%; display: flex; gap: 10px; transition: 0.2s; font-size: 0.95rem; }
        .nav-btn:hover { background: #334155; color: white; }
        .nav-btn.active { background: var(--accent); color: white; border-left: 4px solid #60a5fa; }
        
        .tab-content { display: none; padding: 20px; height: 100%; overflow-y: auto; }
        .tab-content.active-tab { display: block; }
        .card { background: var(--panel); padding: 20px; border-radius: 8px; border: 1px solid #334155; margin-bottom: 15px; }
        .form-input { width: 100%; padding: 10px; background: #0f172a; border: 1px solid #334155; color: white; border-radius: 5px; margin-bottom: 10px; }
        .btn { padding: 10px 20px; border-radius: 5px; border: none; cursor: pointer; font-weight: bold; color: white; }
        .btn-blue { background: var(--accent); } .btn-green { background: var(--green); } .btn-red { background: var(--red); }

        /* --- RADIO STYLES --- */
        .chat-log { flex: 1; overflow-y: auto; padding: 10px; display: flex; flex-direction: column; gap: 8px; }
        .chat-msg { padding: 8px 12px; background: rgba(255,255,255,0.05); border-radius: 6px; border-left: 3px solid #64748b; font-size: 0.9rem; cursor: default; }
        .chat-voice { border-color: var(--orange); cursor: pointer; display: flex; align-items: center; gap: 10px; transition: 0.2s; }
        .chat-voice:hover { background: rgba(245, 158, 11, 0.1); border-left-width: 5px; }
        
        .chan-btn { flex:1; background:#333; border:1px solid #555; color:#aaa; padding:5px; cursor:pointer; font-weight:bold; font-size:0.7rem; }
        .chan-btn:hover { background:#444; }
        .active-chan { background:#00ff00; color:black; border-color:#00ff00; box-shadow:0 0 10px #00ff00; }
        .locked-chan { background:#300; color:#500; cursor:not-allowed; border-color:#500; }
        
        .tactical-ptt { width:100%; height:80px; background:linear-gradient(#333, #111); border:2px solid #555; border-radius:8px; color:#aaa; cursor:pointer; transition:0.1s; }
        .tactical-ptt:active, .tactical-ptt.transmitting { background:#f59e0b; color:black; border-color:#f59e0b; box-shadow:0 0 15px #f59e0b; transform:scale(0.98); }

        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); display: flex; justify-content: center; align-items: center; z-index: 9999; }
        .auth-card { background: var(--panel); padding: 30px; width: 90%; max-width: 400px; text-align: center; border-radius: 10px; border: 1px solid #334155; }
        
        .app-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 10px; }
        .app-icon { background: var(--panel); border: 1px solid #334155; border-radius: 8px; padding: 15px; text-align: center; cursor: pointer; text-decoration: none; color: white; display: block; }
    </style>
</head>
<body>

    <div class="modal-overlay" id="authModal">
        <div class="auth-card" id="loginForm">
            <h2 style="color:var(--accent);">TOC LOGIN</h2>
            <form onsubmit="event.preventDefault(); handleLogin();">
                <input type="email" id="email" placeholder="Email" class="form-input" autocomplete="email">
                <input type="password" id="password" placeholder="Password" class="form-input" autocomplete="current-password">
                <button type="submit" class="btn btn-blue" style="width:100%;">AUTHENTICATE</button>
            </form>
            <p style="font-size:0.8rem; color:#94a3b8; margin-top:15px; cursor:pointer;" onclick="toggleAuth('signup')">New Recruit? Apply Here</p>
        </div>
        <div class="auth-card" id="signupForm" style="display:none;">
            <h2 style="color:var(--green);">RECRUIT APPLICATION</h2>
            <form onsubmit="event.preventDefault(); handleSignup();">
                <input type="text" id="regName" placeholder="Full Name" class="form-input">
                <input type="email" id="regEmail" placeholder="Email" class="form-input" autocomplete="email">
                <input type="password" id="regPass" placeholder="Password" class="form-input" autocomplete="new-password">
                <button type="submit" class="btn btn-green" style="width:100%;">SUBMIT</button>
            </form>
            <p style="font-size:0.8rem; color:#94a3b8; margin-top:15px; cursor:pointer;" onclick="toggleAuth('login')">Back to Login</p>
        </div>
    </div>

    <button class="menu-toggle" onclick="document.querySelector('.sidebar').classList.toggle('open')">â˜° MENU</button>

    <div class="sidebar">
        <div style="padding:20px; border-bottom:1px solid #334155; text-align:center;">
            <div style="font-weight:bold; color:var(--accent); margin-top:5px;">TOC</div>
            <div style="font-size:0.6rem; color:#94a3b8;">Clean House - Clean Work</div>
        </div>
        
        <div class="nav-cat">My Station</div>
        <button class="nav-btn active" onclick="showTab('dashboard')"><span>ðŸ“Š</span> Dashboard</button>
        <button class="nav-btn" onclick="showTab('profile')"><span>ðŸªª</span> My Profile</button>
        <button class="nav-btn
